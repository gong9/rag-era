# RAG çŸ¥è¯†åº“ç³»ç»Ÿ

> åŠå¤©å†™Demoï¼ŒåŠå¹´éš¾ä¸Šçº¿

ä¸€ä¸ªæ”¯æŒ **Agentic RAG + ä¸Šä¸‹æ–‡å·¥ç¨‹ (Context Engineering)** çš„æ™ºèƒ½çŸ¥è¯†åº“ç³»ç»Ÿ

## æ¼”ç¤ºæˆªå›¾

<div align="center">
  <img src="img/demo1.png" alt="Dashboard Demo" width="100%" />
  <p><em>çŸ¥è¯†åº“ç®¡ç†</em></p>
  <br/>
  <img src="img/demo2.png" alt="Chat Demo" width="100%" />
  <p><em>æ™ºèƒ½é—®ç­”</em></p>
  <br/>
  <img src="img/demo3.png" alt="Eval Demo" width="100%" />
  <p><em>RAG è¯„ä¼°ç³»ç»Ÿ</em></p>
  <br/>
  <img src="img/demo4.png" alt="Knowledge Graph Demo" width="100%" />
  <p><em>çŸ¥è¯†å›¾è°±å¯è§†åŒ–</em></p>
</div>

## æ ¸å¿ƒåŠŸèƒ½

- **æ–‡æ¡£ç®¡ç†**: æ”¯æŒ PDFã€DOCXã€TXTã€MD ç­‰æ ¼å¼ä¸Šä¼ å’Œç´¢å¼•
- **æ™ºèƒ½é—®ç­”**: åŸºäºçŸ¥è¯†åº“å†…å®¹çš„ç²¾å‡†ä¸Šä¸‹æ–‡é—®ç­”
- **Agentic RAG**: ReAct Agent å¯è‡ªä¸»é€‰æ‹©å·¥å…·è¿›è¡Œå¤šè½®æ¨ç†
- **ä¸Šä¸‹æ–‡å·¥ç¨‹**: æ™ºèƒ½è®°å¿† + RAGä¼˜åŒ– + è¯­ä¹‰å‹ç¼©ï¼Œæœ€å¤§åŒ– Token ä»·å€¼
- **æ··åˆæœç´¢**: å‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ï¼ŒRRF èåˆæ’åº
- **çŸ¥è¯†å›¾è°±**: LightRAG è‡ªåŠ¨æŠ½å–å®ä½“å…³ç³»ï¼Œæ”¯æŒå›¾è°±å¯è§†åŒ–
- **AI å›¾è¡¨ç”Ÿæˆ**: ä¸¤æ­¥ LLM ç”Ÿæˆï¼ˆé€»è¾‘åˆ†æ â†’ Mermaidï¼‰ï¼Œç¡®ä¿æµç¨‹æ­£ç¡®
- **æ„å›¾é©±åŠ¨**: LLM è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œæ™ºèƒ½è·¯ç”±åˆ°åˆé€‚çš„å·¥å…·
- **è´¨é‡è¯„ä¼°**: å›ç­”è´¨é‡è‡ªåŠ¨æ£€æµ‹ï¼Œä½è´¨é‡æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- **RAG è¯„ä¼°ç³»ç»Ÿ**: å››ç»´åº¦ LLM Judge è‡ªåŠ¨è¯„åˆ†ï¼Œæ”¯æŒ SSE å®æ—¶è¿›åº¦æ¨é€


## ä¸Šä¸‹æ–‡å·¥ç¨‹

æœ¬é¡¹ç›®å®ç°äº†å®Œæ•´çš„**ä¸Šä¸‹æ–‡å·¥ç¨‹ç³»ç»Ÿ**ï¼Œå‚è€ƒ [mem0](https://github.com/mem0ai/mem0) è®¾è®¡æ€è·¯ï¼Œå‘Šåˆ«ç®€å•çš„"å¯¹è¯å†å²å¡å…¥æç¤ºè¯"æ–¹å¼ã€‚

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ™ºèƒ½è®°å¿†** | LLM è‡ªåŠ¨æå–ç”¨æˆ·åå¥½ã€äº‹å®ã€ä¸Šä¸‹æ–‡æŒ‡ä»¤ï¼Œå­˜å‚¨åˆ°å‘é‡æ•°æ®åº“ |
| **æ–°é²œåº¦ä¼˜å…ˆ** | æœ€è¿‘è®¿é—®çš„å†…å®¹æƒé‡æ›´é«˜ï¼Œè¿‡æ—¶å†…å®¹è‡ªåŠ¨è¡°å‡ |
| **ç»Ÿä¸€æ£€ç´¢** | Memory + RAG ç»Ÿä¸€ä½¿ç”¨ RRF æ··åˆæœç´¢ï¼Œä¸€è‡´çš„è¯„åˆ†æœºåˆ¶ |
| **è¯­ä¹‰å‹ç¼©** | Token æ¥è¿‘ä¸Šé™æ—¶ï¼ŒLLM è‡ªåŠ¨å‹ç¼©ä½ä¼˜å…ˆçº§å†…å®¹ |
| **æ„å›¾å¯¹é½** | ä¸Šä¸‹æ–‡æƒé‡æ ¹æ®ç”¨æˆ·æ„å›¾åŠ¨æ€è°ƒæ•´ |
| **è‡ªé€‚åº”æ›´æ–°** | Agent å¤šè½®æ¨ç†æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ä¸Šä¸‹æ–‡åˆ·æ–° |

### æ¶æ„

```
ç”¨æˆ·æŸ¥è¯¢ â†’ æ„å›¾åˆ†æ â†’ ä¸Šä¸‹æ–‡å¼•æ“ â†’ ReAct Agent â†’ å›ç­”
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼              â–¼              â–¼
     æ™ºèƒ½è®°å¿†        RAGæ£€ç´¢        å¯¹è¯å†å²
    (Memory)      (Documents)     (Summary)
          â”‚              â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    RRF ç»Ÿä¸€èåˆ
                         â”‚
                    Token é¢„ç®—ç®¡ç†
                         â”‚
                    è¯­ä¹‰å‹ç¼©ï¼ˆå¯é€‰ï¼‰
```

### ä¸Šä¸‹æ–‡å¼•æ“

ä¸Šä¸‹æ–‡å¼•æ“ (`ContextEngine`) æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£æ™ºèƒ½æ„å»º Agent æ‰€éœ€çš„ä¸Šä¸‹æ–‡ï¼š

```typescript
// æ ¸å¿ƒå…¥å£
const contextEngine = getContextEngine();
const result = await contextEngine.buildContext({
  knowledgeBaseId,
  sessionId,
  userId,
  query,
  chatHistory,
  maxTokens: 3000,  // Token é¢„ç®—
  intent,           // æ„å›¾åˆ†æç»“æœ
});

// è¿”å›ç»“æœ
result.context    // ä¼˜åŒ–åçš„ä¸Šä¸‹æ–‡å­—ç¬¦ä¸²
result.memories   // ç›¸å…³è®°å¿†
result.ragResults // RAG æ£€ç´¢ç»“æœ
result.stats      // Token ä½¿ç”¨ç»Ÿè®¡
```

**ä¸‰é˜¶æ®µå¤„ç†æµç¨‹**ï¼š

1. **Phase 1 - è®°å¿†ç³»ç»Ÿ**: ä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³è®°å¿†
2. **Phase 2 - RAG æ£€ç´¢**: æ··åˆæœç´¢è·å–æ–‡æ¡£ç‰‡æ®µ
3. **Phase 3 - ä¸Šä¸‹æ–‡ä¼˜åŒ–**: å¤šæºåˆå¹¶ + æ„å›¾å¯¹é½ + è¯­ä¹‰å‹ç¼©

### Agent å·¥å…·ç®±

| å·¥å…· | åŠŸèƒ½ |
|------|------|
| `search_knowledge` | ç²¾å‡†æ£€ç´¢ï¼ˆTop-3ï¼Œæ··åˆæœç´¢ï¼‰ |
| `deep_search` | æ·±åº¦æ£€ç´¢ï¼ˆTop-8ï¼Œæ··åˆæœç´¢ï¼‰ |
| `graph_search` | çŸ¥è¯†å›¾è°±æ£€ç´¢ï¼ˆLightRAGï¼‰ |
| `summarize_topic` | ä¸»é¢˜æ€»ç»“ï¼ˆç›´æ¥è¯»å–åŸæ–‡ï¼‰ |
| `keyword_search` | å…³é”®è¯ç²¾ç¡®æœç´¢ï¼ˆMeilisearchï¼‰ |
| `web_search` | æœç´¢äº’è”ç½‘ï¼ˆSearXNGï¼‰ |
| `get_current_datetime` | è·å–å½“å‰æ—¥æœŸæ—¶é—´ |
| `fetch_webpage` | æŠ“å–ç½‘é¡µå†…å®¹ |
| `generate_diagram` | ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ï¼ˆæµç¨‹å›¾/æ—¶åºå›¾ï¼‰ |

### æ™ºèƒ½æ„å›¾è¯†åˆ«

Agent ä¼šè‡ªåŠ¨åˆ†æç”¨æˆ·é—®é¢˜çš„æ„å›¾ï¼š

| æ„å›¾ç±»å‹ | ç¤ºä¾‹ | å¤„ç†æ–¹å¼ |
|----------|------|----------|
| `greeting` | "ä½ å¥½" | ç›´æ¥å›å¤ï¼Œè·³è¿‡ Agent |
| `small_talk` | "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·" | ç›´æ¥å›å¤ |
| `document_summary` | "xxxè®²äº†ä»€ä¹ˆ" | è°ƒç”¨ summarize_topic |
| `knowledge_query` | "ä»€ä¹ˆæ˜¯RAG" | è°ƒç”¨ search_knowledge |
| `draw_diagram` | "ç”»ä¸ªæµç¨‹å›¾" | è°ƒç”¨ generate_diagram |
| `web_search` | "æœ€æ–°çš„AIæ–°é—»" | è°ƒç”¨ web_search |
| `datetime` | "ç°åœ¨å‡ ç‚¹" | è°ƒç”¨ get_current_datetime |

### æ‰§è¡Œé“¾è·¯è¿½è¸ª

æ¯æ¬¡æŸ¥è¯¢ä¼šè®°å½•å®Œæ•´çš„æ‰§è¡Œé“¾è·¯ï¼Œç”¨äºè´¨é‡è¯„ä¼°ï¼š

```
1. ç”¨æˆ·é—®é¢˜ â†’ 2. æ„å›¾åˆ¤æ–­ â†’ 3. ä¸Šä¸‹æ–‡å¼•æ“ â†’ 4. Agentå·¥å…·è°ƒç”¨ â†’ 5. è´¨é‡è¯„ä¼° â†’ 6. æœ€ç»ˆå›ç­”
```

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æŸ¥è¯¢                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ„å›¾åˆ†æ (LLM)                            â”‚
â”‚   greeting â†’ ç›´æ¥å›å¤ â”‚ knowledge_query â†’ Agent å¤„ç†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸Šä¸‹æ–‡å¼•æ“ (ContextEngine)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ è®°å¿†æ£€ç´¢  â”‚  RAG æ··åˆæœç´¢        â”‚ å¯¹è¯å†å²  â”‚            â”‚
â”‚  â”‚ (Memory) â”‚ (Vector+Keyword+Graph)â”‚ (Summary) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚                â”‚                â”‚                   â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                        â–¼                                    â”‚
â”‚              RRF ç»Ÿä¸€èåˆ + Tokené¢„ç®—ç®¡ç†                      â”‚
â”‚                        â–¼                                    â”‚
â”‚              è¯­ä¹‰å‹ç¼©ï¼ˆæ¥è¿‘é¢„ç®—æ—¶è§¦å‘ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ReAct Agent                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ çŸ¥è¯†æ£€ç´¢  â”‚ ç½‘é¡µæœç´¢  â”‚ å›¾è¡¨ç”Ÿæˆ  â”‚ ä¸»é¢˜æ€»ç»“  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è´¨é‡è¯„ä¼° (LLM)                            â”‚
â”‚         é€šè¿‡ â†’ è¿”å› â”‚ ä¸é€šè¿‡ â†’ é‡è¯• (æœ€å¤š3æ¬¡)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RAG è¯„ä¼°ç³»ç»Ÿ

ç³»ç»Ÿå†…ç½®å››ç»´åº¦ LLM Judge è¯„ä¼°æ¡†æ¶ï¼Œæ”¯æŒ**è‡ªåŠ¨ç”Ÿæˆè¯„ä¼°é—®é¢˜**ï¼Œå¯¹ RAG ç³»ç»Ÿè¿›è¡Œå…¨é¢çš„è‡ªåŠ¨åŒ–è¯„æµ‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¯„ä¼°æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       è‡ªåŠ¨ç”Ÿæˆè¯„ä¼°é—®é¢˜ (æ ¹æ®çŸ¥è¯†åº“å†…å®¹)                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ å›ºå®šé—®é¢˜(2ä¸ª):                                â”‚         â”‚
â”‚   â”‚   â€¢ æ€»ç»“çŸ¥è¯†åº“æ–‡æ¡£å†…å®¹ (å¿…é€‰)                   â”‚         â”‚
â”‚   â”‚   â€¢ æ—¶é—´æŸ¥è¯¢/å¤©æ°”æŸ¥è¯¢ (äºŒé€‰ä¸€)                  â”‚         â”‚
â”‚   â”‚ åŠ¨æ€é—®é¢˜(8ä¸ª): LLM æ ¹æ®æ–‡æ¡£å†…å®¹ç”Ÿæˆ             â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é€ä¸ªé—®é¢˜è°ƒç”¨ Agentic RAG è·å–å›ç­”                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å››ç»´åº¦ LLM Judge è¯„åˆ†                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ æ£€ç´¢è´¨é‡  â”‚  å¿ å®åº¦  â”‚ ç­”æ¡ˆè´¨é‡  â”‚ å·¥å…·è°ƒç”¨  â”‚            â”‚
â”‚   â”‚Retrieval â”‚Faithful  â”‚ Quality  â”‚   Tool   â”‚            â”‚
â”‚   â”‚ (0-5åˆ†)  â”‚ (0-5åˆ†)  â”‚ (0-5åˆ†)  â”‚ (0-5åˆ†)  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SSE å®æ—¶æ¨é€ â†’ å‰ç«¯å±•ç¤ºè¯„ä¼°è¿›åº¦                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯„ä¼°é—®é¢˜è‡ªåŠ¨ç”Ÿæˆ**ï¼šæ— éœ€æ‰‹åŠ¨ç¼–å†™ eval.jsonï¼Œç³»ç»Ÿæ ¹æ®æ¯ä¸ªçŸ¥è¯†åº“çš„å®é™…å†…å®¹è‡ªåŠ¨ç”Ÿæˆé’ˆå¯¹æ€§çš„è¯„ä¼°é—®é¢˜ã€‚

| è¯„ä¼°ç»´åº¦ | è¯´æ˜ | è¯„åˆ†æ ‡å‡† |
|----------|------|----------|
| **æ£€ç´¢è´¨é‡** | æ£€ç´¢å†…å®¹ä¸é—®é¢˜çš„ç›¸å…³æ€§ | 5åˆ†=é«˜åº¦ç›¸å…³ï¼Œ0åˆ†=å®Œå…¨æ— å…³ |
| **å¿ å®åº¦** | å›ç­”æ˜¯å¦åŸºäºæ£€ç´¢å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å¹»è§‰ | 5åˆ†=æ— å¹»è§‰ï¼Œ0åˆ†=å®Œå…¨å¹»è§‰ |
| **ç­”æ¡ˆè´¨é‡** | æ­£ç¡®æ€§ã€å®Œæ•´æ€§ã€æ¸…æ™°åº¦ | 5åˆ†=ä¼˜ç§€ï¼Œ0åˆ†=æ— æ•ˆ |
| **å·¥å…·è°ƒç”¨** | Agent å·¥å…·é€‰æ‹©æ˜¯å¦åˆç† (Agentic RAG ç‰¹æœ‰) | 5åˆ†=æœ€ä¼˜é€‰æ‹©ï¼Œ0åˆ†=å®Œå…¨é”™è¯¯ |

> ğŸ’¡ å¯¹äº web_searchã€get_current_datetime ç­‰å·¥å…·ç±»é—®é¢˜ï¼Œæ£€ç´¢è´¨é‡å’Œå¿ å®åº¦ä¼šè‡ªåŠ¨é€‚é…è¯„ä¼°ç­–ç•¥ã€‚

### æ··åˆæœç´¢åŸç†

```
         ç”¨æˆ·æŸ¥è¯¢
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
     â–¼      â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é‡æ£€ç´¢ â”‚ â”‚å…³é”®è¯æ£€ç´¢â”‚ â”‚å›¾è°±æ£€ç´¢ â”‚
â”‚(è¯­ä¹‰ç›¸ä¼¼)â”‚ â”‚(ç²¾ç¡®åŒ¹é…)â”‚ â”‚(å…³ç³»æ¨ç†)â”‚
â”‚LlamaIndexâ”‚ â”‚Meilisearchâ”‚ â”‚LightRAGâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â–¼           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    RRF èåˆæ’åº      â”‚
     â”‚ score = Î£ 1/(k+rank) â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
       èåˆåç»“æœ
```

### çŸ¥è¯†å›¾è°± (LightRAG)

ç³»ç»Ÿé›†æˆ [LightRAG](https://github.com/HKUDS/LightRAG) ä½œä¸ºçŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å¼•æ“ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–‡æ¡£ä¸Šä¼ å                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç‚¹å‡»ã€Œæ„å»ºçŸ¥è¯†å›¾è°±ã€                          â”‚
â”‚         LLM è‡ªåŠ¨æŠ½å–å®ä½“ (Entity) å’Œå…³ç³» (Relation)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­˜å‚¨çŸ¥è¯†å›¾è°±                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚ å®ä½“å‘é‡  â”‚ å…³ç³»å‘é‡  â”‚ å›¾ç»“æ„   â”‚                       â”‚
â”‚   â”‚vdb_entitiesâ”‚vdb_relationsâ”‚.graphmlâ”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æŸ¥è¯¢æ—¶ï¼šhybrid æ¨¡å¼æ£€ç´¢                          â”‚
â”‚     local(å®ä½“) + global(ä¸»é¢˜) â†’ ç»¼åˆæ¨ç†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾è°±å¯è§†åŒ–**ï¼šç‚¹å‡»ã€ŒæŸ¥çœ‹å›¾è°±ã€å¯äº¤äº’å¼æµè§ˆå®ä½“å…³ç³»ç½‘ç»œã€‚

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
DATABASE_URL="file:./dev.db"
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key

# Qwen API (é˜¿é‡Œäº‘)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=qwen-turbo
OPENAI_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1

# Meilisearch (å¯é€‰ï¼Œç”¨äºå…³é”®è¯æœç´¢)
MEILISEARCH_HOST=http://localhost:7700
MEILISEARCH_API_KEY=your-master-key
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
npx prisma generate
npx prisma db push
```

### 4. å¯åŠ¨ Meilisearch (å¯é€‰)

æœ¬åœ° Docker éƒ¨ç½²ï¼š

```bash
./deploy-meilisearch.sh
```

æˆ–è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²ï¼š

```bash
./deploy-meilisearch-remote.sh
```

### 5. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
./dev.sh start

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./dev.sh status

# åœæ­¢æ‰€æœ‰æœåŠ¡
./dev.sh stop
```

å¯åŠ¨åï¼š
- ğŸŒ Next.js: http://localhost:3000
- ğŸ•¸ï¸ LightRAG: http://localhost:8005/health

## ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ chat/          # èŠå¤©æ¥å£
â”‚   â”‚   â”œâ”€â”€ documents/     # æ–‡æ¡£å¤„ç†
â”‚   â”‚   â”œâ”€â”€ eval/          # è¯„ä¼°ç³»ç»Ÿæ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ generate/  # è¯„ä¼°é—®é¢˜ç”Ÿæˆ API
â”‚   â”‚   â”‚   â””â”€â”€ stream/    # SSE å®æ—¶è¿›åº¦æ¨é€
â”‚   â”‚   â””â”€â”€ knowledge-bases/ # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”œâ”€â”€ chat/[id]/         # èŠå¤©é¡µé¢
â”‚   â””â”€â”€ dashboard/         # ç®¡ç†é¡µé¢
â”‚       â”œâ”€â”€ [id]/          # çŸ¥è¯†åº“è¯¦æƒ…é¡µ
â”‚       â””â”€â”€ eval/          # RAG è¯„ä¼°é¡µé¢
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â””â”€â”€ DiagramMessage.tsx # å›¾è¡¨æ¸²æŸ“ç»„ä»¶ (Excalidraw)
â”œâ”€â”€ lib/                   # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ llm/              # LLM æœåŠ¡ & Agentic RAG
â”‚   â”‚   â”œâ”€â”€ agent.ts      # ReAct Agent æ ¸å¿ƒ
â”‚   â”‚   â””â”€â”€ index.ts      # LLM æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ context/          # ğŸ†• ä¸Šä¸‹æ–‡å·¥ç¨‹
â”‚   â”‚   â”œâ”€â”€ engine.ts     # ä¸Šä¸‹æ–‡å¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ intent/       # æ„å›¾åˆ†æ
â”‚   â”‚   â”œâ”€â”€ optimizer/    # ä¸Šä¸‹æ–‡ä¼˜åŒ–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ compressor.ts  # è¯­ä¹‰å‹ç¼©
â”‚   â”‚   â”‚   â””â”€â”€ merger.ts      # å¤šæºåˆå¹¶
â”‚   â”‚   â””â”€â”€ rag/          # RAG ä¼˜åŒ–
â”‚   â”‚       â”œâ”€â”€ query-rewriter.ts  # æŸ¥è¯¢æ”¹å†™
â”‚   â”‚       â””â”€â”€ dedup-filter.ts    # å»é‡è¿‡æ»¤
â”‚   â”œâ”€â”€ memory/           # ğŸ†• æ™ºèƒ½è®°å¿†ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ extractor.ts  # è®°å¿†æå–
â”‚   â”‚   â”œâ”€â”€ store.ts      # è®°å¿†å­˜å‚¨
â”‚   â”‚   â””â”€â”€ freshness.ts  # æ–°é²œåº¦è¯„åˆ†
â”‚   â”œâ”€â”€ hybrid-search.ts  # æ··åˆæœç´¢ & RRF èåˆ
â”‚   â”œâ”€â”€ meilisearch.ts    # Meilisearch æœåŠ¡
â”‚   â”œâ”€â”€ mermaid-cleaner.ts # Mermaid è¯­æ³•æ¸…æ´—
â”‚   â”œâ”€â”€ eval-generator.ts # è¯„ä¼°é—®é¢˜è‡ªåŠ¨ç”Ÿæˆ
â”‚   â”œâ”€â”€ eval-service.ts   # è¯„ä¼°æœåŠ¡ï¼ˆè¿è¡Œè¯„æµ‹ã€ä¿å­˜ç»“æœï¼‰
â”‚   â””â”€â”€ eval-judges.ts    # å››ç»´åº¦ LLM Judge
â”œâ”€â”€ types/                 # TypeScript ç±»å‹
â”œâ”€â”€ lightrag-service/      # LightRAG Python æœåŠ¡
â”‚   â”œâ”€â”€ main.py           # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py         # é…ç½®
â”‚   â””â”€â”€ requirements.txt  # Python ä¾èµ–
```

## è®¸å¯è¯

MIT
